<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <title>OrgChart</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

    <!----------------   ORG CHART NON ESSENTIAL CONTENT ------------>
    <link href="https://unpkg.com/microtip/microtip.css" rel="stylesheet">

    <div class="action-buttons" style="margin:0 40px">


        <button onclick='chart.setExpanded("O-6164")' aria-label='chart.setExpanded("O-6164")'
            data-microtip-position="bottom" role="tooltip">Expand O-6164</button>
        <button onclick='chart.setExpanded("O-6164",false)' aria-label='chart.setExpanded("O-6164",false)'
            data-microtip-position="bottom" role="tooltip">Collapse O-6164</button>
        <button onclick='chart.addNode({id:"root child",parentId:"O-6066"})' aria-label='chart.addNode({id:"root child",parentId:"O-6066"})'
            data-microtip-position="bottom" role="tooltip">Add node as roots' child</button>
        <button onclick='chart.addNode({id:"5-th level node",parentId:"O-6164",expanded:true})'
            aria-label='chart.addNode({id:"5-th level node", parentId:"O-6164", expanded:true})' data-microtip-position="bottom" role="tooltip">Insert node at 5-th
            level</button> 
        <button onclick='chart.removeNode("O-6067")' aria-label='chart.removeNode("O-6067")'
            data-microtip-position="bottom" role="tooltip">Remove O-6067</button>
        <button onclick='chart.layout(["top","right","bottom","left"][index++%4]).render()'
            aria-label='chart.layout(["top","right","bottom","left"][index++%4]).render()' data-microtip-position="bottom" role="tooltip">Swap Layouts
        </button>
        <button onclick='chart.fit()' aria-label='chart.fit()' data-microtip-position="bottom"
            role="tooltip">Fit </button>
        <button onclick='chart.center("O-6162")' aria-label='chart.center("O-6162")'
            data-microtip-position="bottom" role="tooltip">Center O-6162 </button>
    </div>

    <a href="https://github.com/bumbeishvili/d3-organization-chart">
        <img style="position:fixed;top:0;right:0;border:0;z-index:2;" width="149" height="149"
            src="https://bumbeishvili.github.io/d3-tooltip/forkme.png" alt="Fork me on GitHub">
    </a>

    <!----------------  ORG CHART ESSENTIAL CONTENT ---------------->

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="./build/d3-org-chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.0.0/build/d3-flextree.js"></script>
    <div class="chart-container" style=" padding-top:10px;  height:1200px ;background-color:white"> </div>

    <script>
        var index = 0;
        var chart;
        d3.csv('data.csv')
            .then(dataFlattened => {
                chart = new d3.OrgChart()
                    .container('.chart-container')
                    .data(dataFlattened)
                    // .svgHeight(window.innerHeight)
                    // .initialZoom(1)
                    // .nodeWidth((d3Node) => {
                    //     let i = 0;
                    //     if (d3Node.parent) { i = d3Node.parent.children.indexOf(d3Node); }
                    //     return (!i || i == d3Node.parent.children.length - 1) ? 200 : 100
                    // })
                    // .nodeHeight((d3Node) => {
                    //     let i = 0;
                    //     if (d3Node.parent) { i = d3Node.parent.children.indexOf(d3Node); }
                    //     return (!i || i == d3Node.parent.children.length - 1) ? 200 : 100
                    // })
                    // .siblingsMargin(d3Node => 0)
                    // .childrenMargin(d3Node => 60)
                    // .onNodeClick(d => console.log(d + ' node clicked'))
                    // .linkUpdate(function (d3Node, i, arr) {
                    //     const link = this;
                    //     d3.select(link)
                    //         .attr('stroke-dasharray', !i ? '2 2' : 'none')
                    //         .attr('stroke-width', 3)
                    // })
                    // .nodeUpdate(function (data, i, arr) {
                    //     d3.select(this).on('click.node', (event, d, i) => {
                    //         console.log(d.nodeId + ' node clicked')
                    //     })
                    // })
                    // .nodeContent(function (d, i, arr) {
                    //     console.log(d)
                    //     return `
                    //        <div style="padding:0px">
                    //          <img src="${d.data.imageUrl}"  style="border-radius:100px;width:60px;height:60px;" />
                    //          Children Direct:${d.data._directSubordinates}
                    //          Children Total:${d.data._totalSubordinates}
                    //         </div>
                    //     `;
                    // })
                    .render()
            })
    </script>

</body>